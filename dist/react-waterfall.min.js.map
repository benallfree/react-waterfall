{"version":3,"file":"react-waterfall.min.js","sources":["../src/Components/Provider.js","../src/Components/Prevent.js","../src/helpers/connect.js","../src/helpers/subscriptions.js","../src/index.js"],"sourcesContent":["// @flow\n/* eslint-disable no-undef */\n\nimport React, { Component } from 'react'\n\nimport type { CreateProvider, State } from '../types'\n\ntype Props = { children: React$Node, initialState: {} }\n\nconst EnhancedProvider: CreateProvider = (\n  setProvider,\n  Provider,\n  initialState,\n) =>\n  class EnhancedProvider extends Component<Props, State> {\n    constructor(props) {\n      super(props)\n      this.state = props.initialState || initialState\n      setProvider(this)\n    }\n\n    render() {\n      return <Provider value={this.state}>{this.props.children}</Provider>\n    }\n  }\n\nexport default EnhancedProvider\n","// @flow\n/* eslint-disable no-undef */\n\nimport { PureComponent } from 'react'\n\ntype Props = {\n  renderComponent: ({}) => React$Node,\n}\n\nexport default class Prevent extends PureComponent<Props> {\n  render() {\n    const { renderComponent, ...rest } = this.props\n    return renderComponent(rest)\n  }\n}\n","// @flow\n/* eslint-disable no-undef */\n\nimport * as React from 'react'\nimport Prevent from '../Components/Prevent'\n\nimport type { CreateConnect } from '../types'\n\nconst connect: CreateConnect = Consumer => mapStateToProps => WrappedComponent => {\n  const renderComponent = props => <WrappedComponent {...props} />\n  const ConnectedComponent = props => (\n    <Consumer>\n      {state => {\n        const filteredState = mapStateToProps(state || {})\n        return (\n          <Prevent\n            renderComponent={renderComponent}\n            {...props}\n            {...filteredState}\n          />\n        )\n      }}\n    </Consumer>\n  )\n\n  ConnectedComponent.displayName = `Connect(${WrappedComponent.displayName ||\n    WrappedComponent.name ||\n    'Unknown'})`\n\n  return ConnectedComponent\n}\n\nexport default connect\n","// @flow\n/* eslint-disable no-undef */\n\nimport type { Subscription } from '../types'\n\nexport default class Subscriptions {\n  subscriptions = []\n\n  getSubscriptions = () => this.subscriptions\n\n  subscribe = (subscription: Subscription) => {\n    this.subscriptions = [...this.subscriptions, subscription]\n  }\n\n  unsubscribe = (subscription: Subscription) => {\n    this.subscriptions = this.subscriptions.filter(subscriber => subscriber !== subscription)\n  }\n}\n","// @flow\n/* eslint-disable no-undef */\n\nimport { createContext } from 'react'\n\nimport createProvider from './Components/Provider'\nimport createConnect from './helpers/connect'\nimport Subscriptions from './helpers/subscriptions'\nimport devtools from './helpers/devtools'\n\nimport type {\n  CreateStore,\n  ProviderType,\n  SetProvider,\n  CustomSetState,\n  Context,\n} from './types'\n\nconst defaultMiddlewareFactoryBuilders =\n  process.env.NODE_ENV === 'development' &&\n  typeof window !== 'undefined' &&\n  window.devToolsExtension\n    ? [devtools]\n    : []\n\nconst createStore: CreateStore = (\n  { initialState, actionsCreators = {} },\n  middlewareFactoryBuilders = [],\n) => {\n  let provider: ProviderType\n  const context: Context = createContext()\n\n  const { getSubscriptions, subscribe, unsubscribe } = new Subscriptions()\n\n  const setProvider: SetProvider = self => {\n    const initializedMiddlewares = middlewareFactories.map(middlewareFactory =>\n      middlewareFactory({ initialState, actionsCreators }, self),\n    )\n\n    provider = {\n      setState: (state, callback) => self.setState(state, callback),\n      initializedMiddlewares,\n    }\n  }\n\n  let state = initialState\n\n  const setState: CustomSetState = (action, result, ...args) => {\n    state = { ...state, ...result }\n    return new Promise(resolve => {\n      const subscriptions = getSubscriptions()\n      subscriptions.forEach(fn => fn(action, result, ...args))\n      provider.setState(state, () => {\n        provider.initializedMiddlewares.forEach(m => m(action, ...args))\n        resolve()\n      })\n    })\n  }\n\n  const actions = Object.keys(actionsCreators).reduce(\n    (r, v) => ({\n      ...r,\n      [v]: (...args) => {\n        if (!provider) {\n          console.error('<Provider /> is not initialized yet')\n          return\n        }\n\n        const result = actionsCreators[v](state, actions, ...args)\n\n        return result.then\n          ? result.then(result => setState(v, result, ...args))\n          : setState(v, result, ...args)\n      },\n    }),\n    {},\n  )\n\n  const Provider = createProvider(setProvider, context.Provider, initialState)\n  const connect = createConnect(context.Consumer)\n\n  const artifacts = {\n    Provider,\n    connect,\n    actions,\n    subscribe,\n    unsubscribe,\n  }\n\n  const middlewareFactories = [\n    ...middlewareFactoryBuilders,\n    ...defaultMiddlewareFactoryBuilders,\n  ].map(m => {\n    return m({\n      setState,\n      ...artifacts,\n    })\n  })\n  return artifacts\n}\n\nexport default createStore\n"],"names":["EnhancedProvider","setProvider","Provider","initialState","props","state","Component","React","this","children","Prevent","PureComponent","renderComponent","connect","React.createElement","WrappedComponent","ConnectedComponent","Consumer","filteredState","mapStateToProps","displayName","name","Subscriptions","_this","subscriptions","subscription","filter","subscriber","defaultMiddlewareFactoryBuilders","createStore","provider","actionsCreators","middlewareFactoryBuilders","context","createContext","getSubscriptions","subscribe","unsubscribe","setState","action","result","args","Promise","forEach","fn","initializedMiddlewares","m","actions","Object","keys","reduce","r","v","then","error","artifacts","createProvider","middlewareFactories","map","middlewareFactory","self","callback","createConnect","_toConsumableArray"],"mappings":"u5FASA,IAAMA,iBAAmC,SACvCC,EACAC,EACAC,iCAGcC,wGACJA,KACDC,MAAQD,EAAMD,cAAgBA,4EAHRG,uEAQpBC,6BAACL,SAAgBM,KAAKH,OAAQG,KAAKJ,MAAMK,oBCbjCC,6JAAgBC,0EAEIH,KAAKJ,aACnCQ,IADCA,2ECHNC,QAAyB,mBAAY,mBAAmB,gBACtDD,EAAkB,mBAASE,oBAACC,EAAqBX,IACjDY,EAAqB,mBACzBF,oBAACG,OACE,gBACOC,EAAgBC,EAAgBd,cAEpCS,oBAACJ,kCACkBE,GACbR,EACAc,gBAOKE,8BAAyBL,EAAiBK,aAC3DL,EAAiBM,MACjB,eAEKL,KCxBYM,+IAGA,kBAAMC,EAAKC,iDAElB,SAACC,KACND,iCAAoBD,EAAKC,uBAAeC,yCAGjC,SAACA,KACRD,cAAgBD,EAAKC,cAAcE,OAAO,mBAAcC,IAAeF,OCG1EG,oCAOAC,YAA2B,gBAI3BC,EAHF3B,IAAAA,iBAAc4B,gBAAAA,kBAChBC,4DAGMC,EAAmBC,wBAE4B,IAAIZ,cAAjDa,IAAAA,iBAAkBC,IAAAA,UAAWC,IAAAA,YAajChC,EAAQF,EAENmC,EAA2B,SAACC,EAAQC,8BAAWC,iFACtCpC,EAAUmC,GAChB,IAAIE,QAAQ,YACKP,IACRQ,QAAQ,mBAAMC,gBAAGL,EAAQC,UAAWC,QACzCH,SAASjC,EAAO,aACdwC,uBAAuBF,QAAQ,mBAAKG,gBAAEP,UAAWE,eAM1DM,EAAUC,OAAOC,KAAKlB,GAAiBmB,OAC3C,SAACC,EAAGC,2BACCD,qBACFC,EAAI,sCAAIX,gDACFX,OAKCU,EAAST,EAAgBqB,YAAG/C,EAAO0C,UAAYN,WAE9CD,EAAOa,KACVb,EAAOa,KAAK,mBAAUf,gBAASc,EAAGZ,UAAWC,MAC7CH,gBAASc,EAAGZ,UAAWC,YARjBa,MAAM,+CAiBhBC,YAHWC,iBA5CgB,gBACzBX,EAAyBY,EAAoBC,IAAI,mBACrDC,qCAAqDC,iBAI3C,SAACvD,EAAOwD,UAAaD,EAAKtB,SAASjC,EAAOwD,+BAsCX5B,EAAQ/B,SAAUC,WAC/C2D,QAAc7B,EAAQhB,+CAUhCwC,EAAsBM,mBACvB/B,UACAJ,kCACH8B,IAAI,mBACGZ,6BAEFS,aAGAA"}